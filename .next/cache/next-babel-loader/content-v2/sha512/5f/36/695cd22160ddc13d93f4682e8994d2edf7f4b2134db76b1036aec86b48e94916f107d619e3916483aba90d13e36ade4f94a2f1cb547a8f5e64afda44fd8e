{"ast":null,"code":"var _jsxFileName = \"/home/runner/thetahacks/pages/new/charity.js\";\nvar __jsx = React.createElement;\nimport React, { useState, useEffect } from \"react\";\nimport { Formik } from \"formik\";\nimport firebase from \"firebase\";\nimport { charityWrite } from \"../../lib/api\";\n\nconst NewCharity = () => {\n  const onSubmit = async ({\n    donationLinks,\n    description,\n    website,\n    name,\n    tags,\n    photo\n  }, {\n    setSubmitting\n  }) => {\n    const user = firebase.auth().currentUser;\n\n    if (!user) {\n      window.location = '/login'; // is this the right way to do this?\n    }\n\n    const reader = new FileReader();\n\n    reader.onload = async () => {\n      charityWrite({\n        name,\n        photo: {\n          name: photo.name,\n          body: reader.result\n        },\n        desc: description,\n        website,\n        tags,\n        links: donationLinks,\n        owner: user.name,\n        token: await user.getIdToken()\n      });\n    };\n\n    ;\n    setSubmitting(false);\n  };\n\n  const validate = ({\n    photo,\n    name,\n    description,\n    donationLinks,\n    website\n  }) => {\n    const errors = {};\n    let url;\n\n    try {\n      url = new URL(website);\n    } catch (e) {\n      errors.website = \"Invalid donation links.\";\n      return;\n    }\n\n    if (url.protocol != \"https\" || url.protocol != \"http\") {\n      errors.donationLinks = \"Invalid donation links.\";\n      return;\n    }\n\n    if (name.length < 8) {\n      errors.name = \"Charity name too short.\";\n    } else if (name.length > 64) {\n      errors.name = \"Charity name too long.\";\n    } else if (description.length < 32) {\n      errors.description = \"Description too short.\";\n    } else if (description.length > 512) {\n      errors.description = \"Description too long.\";\n    } else if (photo.size > 1024 * 1024 * 5) {\n      errors.photo = \"File too large.\";\n    } else {\n      const dLinks = donationLinks.split(\",\").map(link => link.trim()).filter(link => link);\n      dLinks.forEach(link => {\n        let url;\n\n        try {\n          url = new URL(link);\n        } catch (e) {\n          errors.donationLinks = \"Invalid donation links.\";\n          return;\n        }\n\n        if (url.protocol != \"https\" || url.protocol != \"http\") {\n          errors.donationLinks = \"Invalid donation links.\";\n          return;\n        }\n      });\n    }\n\n    return errors;\n  };\n\n  return __jsx(Formik, {\n    initialValues: {\n      name: '',\n      description: '',\n      donationLinks: '',\n      website: ''\n    },\n    validate: validate,\n    onSubmit: onSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 3\n    }\n  }, ({\n    values,\n    errors,\n    touched,\n    handleChange,\n    handleBlur,\n    handleSubmit,\n    isSubmitting,\n    setFieldValue\n  }) => __jsx(\"form\", {\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 5\n    }\n  }, __jsx(\"input\", {\n    type: \"file\",\n    name: \"photo\",\n    onChange: e => setFieldValue(\"photo\", e.target.files[0]),\n    onBlur: handleBlur,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 6\n    }\n  }), errors.photo && touched.photo && errors.photo, __jsx(\"input\", {\n    type: \"text\",\n    name: \"name\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: values.name,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 6\n    }\n  }), errors.name && touched.name && errors.name, __jsx(\"textarea\", {\n    type: \"text\",\n    name: \"description\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: values.description,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 6\n    }\n  }), errors.description && touched.description && errors.description, __jsx(\"input\", {\n    type: \"text\",\n    name: \"website\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: values.website,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 113,\n      columnNumber: 6\n    }\n  }), errors.website && touched.website && errors.website, __jsx(\"input\", {\n    type: \"text\",\n    name: \"donationLinks\",\n    onChange: handleChange,\n    onBlur: handleBlur,\n    value: values.donationLinks,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 6\n    }\n  }), errors.donationLinks && touched.donationLinks && errors.donationLinks, __jsx(\"button\", {\n    type: \"submit\",\n    disabled: isSubmitting,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 6\n    }\n  }, \" Submit \")));\n};\n\nexport default NewCharity;","map":{"version":3,"sources":["/home/runner/thetahacks/pages/new/charity.js"],"names":["React","useState","useEffect","Formik","firebase","charityWrite","NewCharity","onSubmit","donationLinks","description","website","name","tags","photo","setSubmitting","user","auth","currentUser","window","location","reader","FileReader","onload","body","result","desc","links","owner","token","getIdToken","validate","errors","url","URL","e","protocol","length","size","dLinks","split","map","link","trim","filter","forEach","values","touched","handleChange","handleBlur","handleSubmit","isSubmitting","setFieldValue","target","files"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { Formik } from \"formik\";\nimport firebase from \"firebase\";\nimport { charityWrite } from \"../../lib/api\";\n\nconst NewCharity = () => {\n\t\n\tconst onSubmit = async ({ donationLinks, description, website, name, tags, photo }, { setSubmitting }) => {\n\t\tconst user = firebase.auth().currentUser;\n        if (!user) {\n            window.location = '/login'; // is this the right way to do this?\n        }\n        const reader = new FileReader();\n        reader.onload = async () => {\n            charityWrite({ \n                name, \n                photo: {\n                    name: photo.name,\n                    body: reader.result,\n                }, \n                desc: description, \n                website, \n                tags, \n                links: donationLinks, \n                owner: user.name, \n                token: await user.getIdToken()\n            });\n        };;\n        \n\t\tsetSubmitting(false);\n\t};\n\n\tconst validate = ({ photo, name, description, donationLinks, website }) => {\n\t\tconst errors = {};\n\t\t\n\t\tlet url;\n\t\ttry {\n\t\t\turl = new URL(website);\n\t\t} catch(e){\n\t\t\terrors.website = \"Invalid donation links.\";\n\t\t\treturn;\n\t\t}\n\t\tif(url.protocol != \"https\" || url.protocol != \"http\"){\n\t\t\terrors.donationLinks = \"Invalid donation links.\";\n\t\t\treturn;\n\t\t}\n\n\t\tif(name.length < 8){\n\t\t\terrors.name = \"Charity name too short.\"\n\t\t} else if(name.length > 64){\n\t\t\terrors.name = \"Charity name too long.\";\n\t\t} else if(description.length < 32){\n\t\t\terrors.description = \"Description too short.\";\n\t\t} else if(description.length > 512){\n\t\t\terrors.description = \"Description too long.\";\n\t\t} else if(photo.size > 1024*1024*5){\n\t\t\terrors.photo = \"File too large.\";\n\t\t} else {\n\t\t\tconst dLinks = donationLinks.split(\",\").map(link =>  link.trim()).filter(link => link);\n\n\t\t\tdLinks.forEach(link => {\n\t\t\t\tlet url;\n\t\t\t\ttry {\n\t\t\t\t\turl = new URL(link);\n\t\t\t\t} catch(e){\n\t\t\t\t\terrors.donationLinks = \"Invalid donation links.\";\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tif(url.protocol != \"https\" || url.protocol != \"http\"){\n\t\t\t\t\terrors.donationLinks = \"Invalid donation links.\";\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn errors;\n\t};\n\n\treturn (\n\t\t<Formik\n\t\t\tinitialValues={{ name: '', description: '', donationLinks: '', website: '' }}\n\t\t\tvalidate={validate}\n\t\t\tonSubmit={onSubmit}\n\t\t>\n\t\t\t{({ values, errors, touched, handleChange, handleBlur, handleSubmit, isSubmitting, setFieldValue }) => (\n\t\t\t\t<form onSubmit={handleSubmit}>\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"file\"\n\t\t\t\t\t\tname=\"photo\"\n\t\t\t\t\t\tonChange={e => setFieldValue(\"photo\", e.target.files[0])}\n\t\t\t\t\t\tonBlur={handleBlur}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.photo && touched.photo && errors.photo}\n\t\t\t\t\t\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tname=\"name\"\n\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\tonBlur={handleBlur}\n\t\t\t\t\t\tvalue={values.name}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.name && touched.name && errors.name}\n\n\t\t\t\t\t<textarea\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tname=\"description\"\n\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\tonBlur={handleBlur}\n\t\t\t\t\t\tvalue={values.description}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.description && touched.description && errors.description}\n\t\t\t\t\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tname=\"website\"\n\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\tonBlur={handleBlur}\n\t\t\t\t\t\tvalue={values.website}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.website && touched.website && errors.website}\n\n\t\t\t\t\t<input\n\t\t\t\t\t\ttype=\"text\"\n\t\t\t\t\t\tname=\"donationLinks\"\n\t\t\t\t\t\tonChange={handleChange}\n\t\t\t\t\t\tonBlur={handleBlur}\n\t\t\t\t\t\tvalue={values.donationLinks}\n\t\t\t\t\t/>\n\t\t\t\t\t{errors.donationLinks && touched.donationLinks && errors.donationLinks}\n\n\t\t\t\t\t<button type=\"submit\" disabled={isSubmitting}> Submit </button>\n\t\t\t\t</form>\n\t\t\t)}\n\t\t</Formik>\n\t);\n};\n\nexport default NewCharity;"]},"metadata":{},"sourceType":"module"}